{"version":3,"file":"immox.js","sources":["../index.ts","../node_modules/use-immer/dist/use-immer.module.js"],"sourcesContent":["import { useMemo } from 'react'\r\n//import { immerable } from 'immer'\r\nimport { useImmer } from 'use-immer'\r\n\r\nexport function useImmox<State extends object>(initialState: State) {\r\n  const depends: Set<string | number | symbol> = new Set()\r\n  const clonedState = {\r\n    /* [immerable]: true */\r\n  } as State\r\n  const getters: Map<string, { get: () => any; depends: (string | number | symbol)[] }> = new Map()\r\n  const proxy = new Proxy(initialState, {\r\n    get: function(target, name) {\r\n      depends.add(name)\r\n    },\r\n  })\r\n  let keys: string[] = []\r\n  let obj: State | object = {}\r\n  if (Object.getPrototypeOf(initialState).constructor.name === 'Object') {\r\n    keys = Object.keys(initialState)\r\n    obj = initialState\r\n  } else {\r\n    keys = [\r\n      ...Object.keys(Object.getOwnPropertyDescriptors(Object.getPrototypeOf(initialState))),\r\n      ...Object.keys(initialState),\r\n    ]\r\n    obj = Object.getPrototypeOf(initialState)\r\n  }\r\n  keys.forEach(prop => {\r\n    const desc = Object.getOwnPropertyDescriptor(obj, prop)\r\n    if (desc && desc.get) {\r\n      clonedState[prop] = desc.get.call(proxy)\r\n      getters.set(prop, { get: desc.get, depends: Array.from(depends) })\r\n      depends.clear()\r\n    } else {\r\n      clonedState[prop] = initialState[prop]\r\n    }\r\n  })\r\n\r\n  const [state, updateState] = useImmer<State>(clonedState)\r\n\r\n  getters.forEach((value, prop) => {\r\n    const depends = value.depends.map(depend => state[depend])\r\n    //eslint-disable-next-line\r\n    useMemo(() => {\r\n      updateState(d => {\r\n        d[prop] = value.get.call(d)\r\n      })\r\n      //eslint-disable-next-line\r\n    }, depends)\r\n  })\r\n\r\n  return [state, updateState]\r\n}\r\n\r\nexport default useImmox\r\n","import r from\"immer\";import{useState as t,useReducer as n,useCallback as o}from\"react\";function i(n){var i=t(n),m=i[1];return[i[0],o(function(t){m(r(t))},[])]}function m(t,i,m){var e=o(r(t),[t]);return n(e,i,m)}export{i as useImmer,m as useImmerReducer};\n//# sourceMappingURL=use-immer.module.js.map\n"],"names":["useImmox","initialState","depends","Set","clonedState","getters","Map","proxy","Proxy","get","target","name","add","keys","obj","Object","getPrototypeOf","constructor","getOwnPropertyDescriptors","forEach","prop","desc","getOwnPropertyDescriptor","call","set","Array","from","clear","n","i","t","m","o","r","useImmer","value","map","depend","state","useMemo","updateState","d"],"mappings":"wGAIgBA,EAA+BC,OACvCC,EAAyC,IAAIC,IAC7CC,EAAc,GAGdC,EAAkF,IAAIC,IACtFC,EAAQ,IAAIC,MAAMP,EAAc,CACpCQ,IAAK,SAASC,EAAQC,GACpBT,EAAQU,IAAID,MAGZE,EAAiB,GACjBC,EAAsB,GACmC,WAAzDC,OAAOC,eAAef,GAAcgB,YAAYN,MAClDE,EAAOE,OAAOF,KAAKZ,GACnBa,EAAMb,IAENY,EAAOE,OACKF,KAAKE,OAAOG,0BAA0BH,OAAOC,eAAef,YACnEc,OAAOF,KAAKZ,IAEjBa,EAAMC,OAAOC,eAAef,IAE9BY,EAAKM,iBAAQC,OACLC,EAAON,OAAOO,yBAAyBR,EAAKM,GAC9CC,GAAQA,EAAKZ,KACfL,EAAYgB,GAAQC,EAAKZ,IAAIc,KAAKhB,GAClCF,EAAQmB,IAAIJ,EAAM,CAAEX,IAAKY,EAAKZ,IAAKP,QAASuB,MAAMC,KAAKxB,KACvDA,EAAQyB,SAERvB,EAAYgB,GAAQnB,EAAamB,WClCgD,SAAWQ,GAAG,IAAIC,EAAEC,WDsC5D1B,GCtCiE2B,EAAEF,EAAE,GAAG,MAAM,CAACA,EAAE,GAAGG,cAAE,SAASF,GAAGC,EAAEE,EAAEH,KAAK,KDsC3HI,wBAE7B7B,EAAQc,iBAASgB,EAAOf,OAChBlB,EAAUiC,EAAMjC,QAAQkC,aAAIC,UAAUC,EAAMD,KAElDE,qBACEC,WAAYC,GACVA,EAAErB,GAAQe,EAAM1B,IAAIc,KAAKkB,MAG1BvC,KAGE,CAACoC,EAAOE"}